{% extends "base.html" %}

{% block title %}Chaperone Sign up | BBHS {% endblock title %}

{% block body %}

<!-- Needs to
    + Display all information about the event
    + Have a form for signing up the user
    + Have a form for removing the user (maybe auth)
    + Have contact information for the administrator
        - Maybe a "Contact Me" form
        + Good design - use twitter bootstrap

    + When a user has not signed up, offer to sign up
    + When a user is signed up, offer to resign
    -->

<h1>{{ event.name }}</h1>

<div class="tabbable">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#tab1" data-toggle="tab">Event Info</a></li>
        {% if add_chaperones %}
        <li><a href="#tab4" data-toggle="tab">Sign someone up</a></li> <!-- Admin only -->
        {% endif %}
        {% if remove_chaperones %}
        <li><a href="#tab5" data-toggle="tab">Remove a volunteer</a></li> <!-- Admin only -->
        {% endif %}
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="tab1">
		<div class="row">
			<div class="span6">
            {% if event.expired %}
            <h4 style="font-family:verdana;color:red;"> Warning: This event has already taken place </h4>
            {% endif %}

           <div class="well"> <p>{{ description | safe }}</p></div>


        </div>

			<div class="span6">

            <h5>When: </h5>
                {{ event.date }}

            <h5>Person in charge:</h5>
            <p><a href="{{ event.admin.get_absolute_url }}">
				{{ event.admin }} ({{ event.admin.get_full_name}})</p></a>

            <h5>Volunteers Needed</h5>
            <p>{{ event.volunteersNeeded }}</p>

            {% if view_chaperones %}
            <h5>Volunteers Signed Up</h5>
            <ul>
            {% for user in event.getVolunteers %}
            <li><a href="{{ user.get_absolute_url }}"> <!-- This should be a
                userprofile -->
                {{ user }} 
                {% if user.get_full_name %}
                ({{ user.get_full_name }})
                {% endif %}
            </a></li>
            {% endfor %}
        </ul>
            {% endif %}
            
            <!-- Start -->
            
            <h5>Public Notes </h5>
            {% if public_notes %}
            <ul>
            {% for note in public_notes %}
            	<h6>User</h6>
            	<p>{{ note.author }}</p>
            	
            	<h6>Date noted</h6>
            	<p>{{ note.pub_date }}</p>
            	
            	<h6>Content</h6>
            	<p>{{ note.text }}</p>
            	<hr>
            {% endfor %}
            </ul>
            </h5>
            {% else %}
            None
            {% endif %}

				<h5>Private Notes</h5>
				{% if private_notes %}
				<ul>
					{% for note in private_notes %}
            	<h6>User</h6>
            	<p>{{ note.author }}</p>
            	
            	<h6>Date noted</h6>
            	<p>{{ note.pub_date }}</p>
            	
            	<h6>Content</h6>
            	<p>{{ note.text }}</p>
            	<hr>
					{% endfor %}
				</ul>
				{% else %}
					{% if isAdmin %}
					<p>No private notes available</p>
					{% else %}
					<p>You don't have security clearance to view private notes</p>
					{% endif %}
				{% endif %}
				
				
            
            <!-- End -->

        
        <div class="row">
        			{% if sign_up %}
                <div class="span3">
                        <form method="GET" action="{{ event.get_absolute_url }}/signUp">
                        {% csrf_token %}
                        <textarea rows="3" name="note"></textarea>
                        
                        <label class="checkbox">
									<input type="checkbox" name="private" value="true">
									Private note
								</label>
                        <button class="btn btn-large btn-success" type="submit">Sign up for this event!</button>
                        </form>

			{% endif %}
			{% if unsign_up %}


                </div>
                <div class="span3">
                        <form method="POST" action="{{ event.get_absolute_url }}/removeUser/">
                        {% csrf_token %}
                        <button class="btn btn-large btn-warning" type="submit" name="userPk" value="{{ user.pk }}">Unregister</button>
                        </form>
                </div>
        {% endif %}
        </div>






        </div> <!-- close span -->
	</div> <!-- close row -->
	</div> <!-- close tab -->


        {% if add_chaperones %}
        <div class="tab-pane" id="tab4">
            <p>Sign up a user for volunteering</p>
            <form method="POST" action="{{ event.get_absolute_url }}/signUp">
                {% csrf_token %}
                <select name="userPk">
                    {% for user in users %}
                    <option value="{{ user.pk }}">{{ user }}</option>
                    <!-- TODO: Test for logged in user, and continue -->
                    {% endfor %}
                </select>
                <br/>
                <button type="submit" class="btn">Sign up</button>
            </form>
        </div>
        {% endif %}

        {% if remove_chaperones %} <!-- TODO: Find a way to remove the form if
        not volunteers left to remove -->
        <div class="tab-pane" id="tab5">
            <form method="POST" action="{{ event.get_absolute_url }}/removeUser/">
                {% csrf_token %}
                <select name="userPk">
                    {% for user in event.getVolunteers %}
                    <option value="{{ user.pk }}">{{ user }}</option>
                    {% endfor %}
                </select>
                <br/>
                <button type="submit" class="btn">Remove</button>
            </form>
        </div>
        {% endif %}

    </div>
</div>
{% endblock body %}
